
<body style="background-color: beige;">

  <div class="main-banner wow fadeIn" id="top" data-wow-duration="1s" data-wow-delay="0.5s">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
            <div class="form-container" style="padding-top: 5%">
            <h2>PHI·∫æU NH·∫¨P KHO - WAREHOUSE MANAGER T&H</h2>

            <div class="header-top">
              <button type="button" (click)="resetForm()" class="btn-reset">üîÑ T·∫°o l·∫°i</button>
            </div>

            <form (ngSubmit)="submitForm()" enctype="multipart/form-data">
              <!-- Ng√†y t·∫°o -->
              <div class="row">
                <label>Ng√†y t·∫°o:</label>
                <input type="date" [(ngModel)]="formData.created_date" name="created_date" readonly>

                <label>M√£ phi·∫øu:</label>
                <input type="text" [value]="generatedReceiptCode || 'ƒêang t·∫°o...'" readonly>
              </div>

              <!-- T√™n nh√† cung c·∫•p -->
              <div class="row">
                <label>T√™n nh√† cung c·∫•p:</label>
                <input [(ngModel)]="formData.supplier_name" name="supplier_name" required (ngModelChange)="onFieldChange()">
              </div>

              <!-- Logo nh√† cung c·∫•p -->
              <div class="row">
                <label>Logo nh√† cung c·∫•p:</label>
                <input type="file" accept="image/*" (change)="onLogoChange($event)">
                <img *ngIf="formData.logoPreview" [src]="formData.logoPreview" class="preview-img">
              </div>

              <!-- ƒê·ªãa ch·ªâ nh√† cung c·∫•p -->
              <div class="row">
                <label>ƒê·ªãa ch·ªâ nh√† cung c·∫•p:</label>
                <input type="text" [(ngModel)]="formData.supplier_address" name="supplier_address" required (ngModelChange)="onFieldChange()">              </div>

              <!-- Th√¥ng tin ƒë·∫°i di·ªán nh√† cung c·∫•p -->
              <div class="info-card">
                <h4>Th√¥ng tin li√™n l·∫°c nh√† cung c·∫•p</h4>
                <div class="row">
                  <label>H·ªç v√† t√™n ƒë·∫°i di·ªán:</label>
                  <input type="text" [(ngModel)]="formData.representative_name" name="representative_name" required (ngModelChange)="onFieldChange()">
                </div>

                <div class="row">
                  <label>Email ƒë·∫°i di·ªán:</label>
                  <input type="email" [(ngModel)]="formData.representative_email" name="representative_email" required (ngModelChange)="onFieldChange()">
                </div>

                <div class="row">
                  <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                  <input type="text" [(ngModel)]="formData.representative_phone" name="representative_phone" required (ngModelChange)="onFieldChange()">
                </div>
              </div>

              <!-- üîî Ghi ch√∫ y√™u c·∫ßu c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin -->
              <div class="alert alert-warning" style="margin-bottom: 15px; background-color: #fff3cd; padding: 10px; border-left: 5px solid #ffc107;">
                 <strong>L∆∞u √Ω:</strong> Phi·∫øu ch·ªâ ƒë∆∞·ª£c g·ª≠i khi b·∫°n c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin nh√¢n vi√™n.
              </div>

              <div class="info-card">
                <!-- T√™n nh√¢n vi√™n -->
                <div class="row">
                  <label>T√™n nh√¢n vi√™n t·∫°o phi·∫øu</label>
                  <input type="text" [value]="userInfo.full_name" readonly>
                </div>
                
                <!-- T√†i kho·∫£n nh√¢n vi√™n-->
                <div class="row">
                  <label>T√†i kho·∫£n nh√¢n vi√™n t·∫°o phi·∫øu</label>
                  <input type="text" [value]="userEmail" readonly>
                </div>
              </div>


              <h4>Danh s√°ch s·∫£n ph·∫©m nh·∫≠p kho</h4>

              <!-- Nh·∫≠p m√£ & n√∫t th√™m: g·ªçn, n·∫±m ngang -->
              <div style="display: flex; align-items: flex-end; gap: 10px; margin-bottom: 12px;">
                <label style="white-space: nowrap;">üîç M√£ s·∫£n ph·∫©m c√≥ s·∫µn (tr∆∞·ªùng h·ª£p cung c·∫•p h√†ng):</label>
                <input 
                  type="text" 
                  [(ngModel)]="maSanPhamCanThem" 
                  name="maSanPhamCanThem" 
                  placeholder="VD: SP001"
                  style="width: 160px; padding: 4px 8px;" 
                />
                <button 
                  type="button" 
                  (click)="themSanPhamCoSan()" 
                  style="padding: 5px 12px; white-space: nowrap;"
                >
                  Th√™m
                </button>
              </div>



              <div style="overflow-x: auto;" class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>H√¨nh ·∫£nh</th>
                      <th>M√£ s·∫£n ph·∫©m</th>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th>Lo·∫°i</th>
                      <th>ƒê∆°n v·ªã</th>
                      <th>Ng√†y s·∫£n xu·∫•t</th>
                      <th>H·∫°n s·ª≠ d·ª•ng</th>
                      
                      <th>S·ªë l∆∞·ª£ng</th>
                      <th>Tr·ªçng l∆∞·ª£ng 1 s·∫£n ph·∫©m (KG)</th> <!-- üÜï C·ªôt m·ªõi -->
                      <th>Tr·ªçng l∆∞·ª£ng l√¥ h√†ng (KG)</th>
                      <th>Di·ªán t√≠ch (m<sup>2</sup>)</th>

                      <th>ƒê∆°n gi√°</th>
                      <th>Th√†nh ti·ªÅn</th>
                      <th>Xo√°</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of formData.products; let i = index">
                      <td>{{ i + 1 }}</td>

                      <!-- ·∫¢nh -->
                      <td>
                        <input *ngIf="!item.readonly" type="file" accept="image/*" (change)="onProductImageChange($event, i)">
                        <img *ngIf="item.preview" [src]="item.preview" class="preview-img-small">
                      </td>

                      <!-- M√£ s·∫£n ph·∫©m -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableCode">
                          <span>{{ item.product_code }}</span>
                        </ng-container>
                        <ng-template #editableCode>
                          <input [(ngModel)]="item.product_code" name="code{{i}}" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- T√™n s·∫£n ph·∫©m -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableName">
                          <span>{{ item.product_name }}</span>
                        </ng-container>
                        <ng-template #editableName>
                          <input [(ngModel)]="item.product_name" name="product_name{{i}}" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- Lo·∫°i -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableType">
                          <span>{{ item.product_type }}</span>
                        </ng-container>
                        <ng-template #editableType>
                          <input [(ngModel)]="item.product_type" name="type{{i}}" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- ƒê∆°n v·ªã -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableUnit">
                          <span>{{ item.unit }}</span>
                        </ng-container>
                        <ng-template #editableUnit>
                          <input [(ngModel)]="item.unit" name="unit{{i}}" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- Ng√†y s·∫£n xu·∫•t -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableNSX">
                          <span>{{ item.manufacture_date }}</span>
                        </ng-container>
                        <ng-template #editableNSX>
                          <input [(ngModel)]="item.manufacture_date" name="nsx{{i}}" type="date" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- H·∫°n s·ª≠ d·ª•ng -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editableHSD">
                          <span>{{ item.expiry_date }}</span>
                        </ng-container>
                        <ng-template #editableHSD>
                          <input [(ngModel)]="item.expiry_date" name="hsd{{i}}" type="date" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>

                      <!-- S·ªë l∆∞·ª£ng -->
                      <td>
                        <input [(ngModel)]="item.quantity" name="quantity{{i}}" type="number" required 
                              (ngModelChange)="updateWeightAndArea(i); onFieldChange()">
                      </td>

                      <!-- Tr·ªçng l∆∞·ª£ng 1 SP -->
                      <td>
                        <div style="display: flex; align-items: center;">
                          <ng-container *ngIf="item.readonly; else editableKg">
                            <span>{{ item.kg_per_unit }} kg</span>
                          </ng-container>
                          <ng-template #editableKg>
                            <input [(ngModel)]="item.kg_per_unit" name="kgperunit{{i}}" type="number" required
                                  style="width: 80px;" (input)="updateWeightAndArea(i); onFieldChange()">
                          </ng-template>
                        </div>
                      </td>

                      <!-- Tr·ªçng l∆∞·ª£ng l√¥ h√†ng -->
                      <td>
                        <div style="display: flex; align-items: center;">
                          <input 
                            [(ngModel)]="item.weight" 
                            name="weight{{i}}" 
                            type="number" 
                            (input)="updateKgPerUnit(i)" 
                            style="width: 80px;"
                          /> <!-- üëà Th√™m v√†o ƒë√¢y -->
                          <span style="margin-left: 4px;">kg</span>
                        </div>
                      </td>


                      <!-- Di·ªán t√≠ch -->
                      <td>
                        <div style="display: flex; align-items: center;">
                          <input [(ngModel)]="item.area" name="area{{i}}" type="number" readonly
                                style="width: 80px; background-color: #f9f9f9;">
                          <span style="margin-left: 4px;">m¬≤</span>
                        </div>
                      </td>

                      <!-- ƒê∆°n gi√° -->
                      <td>
                        <ng-container *ngIf="item.readonly; else editablePrice">
                          <span>{{ item.unit_price | number:'1.0-0' }}</span>
                        </ng-container>
                        <ng-template #editablePrice>
                          <input [(ngModel)]="item.unit_price" name="price{{i}}" type="number" required (ngModelChange)="onFieldChange()">
                        </ng-template>
                      </td>


                      <!-- Th√†nh ti·ªÅn -->
                      <td>{{ item.quantity * item.unit_price | number:'1.0-0' }}</td>

                      <!-- Xo√° -->
                      <td>
                        <button type="button" (click)="removeProduct(i)">‚ùå</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <button type="button" (click)="addProduct()">Th√™m khung nh·∫≠p</button>

              <br>

              <!-- T·ªïng c·ªông -->
              <div class="row total-row">
                <h4>T·ªïng c·ªông: <span>{{ calculateTotal() | number:'1.0-0' }} VNƒê</span></h4>
              </div>

              <!-- Ng√†y h·∫πn g·∫∑p m·∫∑t -->
              <div class="row">
                <label>Ng√†y h·∫πn nh·∫≠p h√†ng:</label>
                <input type="date" [(ngModel)]="formData.appointment_date" name="appointment_date" required (ngModelChange)="onFieldChange()">
              </div>

              <!-- Ghi ch√∫ -->
              <div class="row">
                <label>Ghi ch√∫ cho qu·∫£n l√Ω kho (n·∫øu c√≥):</label>
                <textarea rows="4" [(ngModel)]="formData.note" name="note" placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥..." (ngModelChange)="onFieldChange()"></textarea>
              </div>


              <!-- G·ª≠i -->
              <button type="submit" class="submit-btn">‚úÖ G·ª≠i phi·∫øu nh·∫≠p h√†ng</button>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>

</body>